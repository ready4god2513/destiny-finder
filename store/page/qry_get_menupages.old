
<!--- CFWebstore®, version 5.72 --->

<!--- CFWebstore® is ©Copyright 1998-2006 by Dogpatch Software, All Rights Reserved. This code may not be copied or sold without permission of the original author. Dogpatch Software may be contacted at info@cfwebstore.com --->

<!--- Query used to retrieve the list of pages for the menus. Cached to improve performance. Called by page.menu and admin/act_page.cfm to refresh the cached query. --->

<cfparam name="attributes.all" default="0">
<cfparam name="attributes.parent_id" default="">

<cfif trim(attributes.parent_id) is "HEADER">
	<cfset attributes.Parent_id = attributes.Page_id>
</cfif>

<cfquery name="qry_Get_menupages" datasource="#Request.DS#" username="#Request.user#" password="#Request.pass#" cachedwithin="#Request.Cache#">
SELECT A.Parent_ID, A.Priority, B.Title_Priority, A.Title_Priority AS istitle, A.Page_ID, 
A.Sm_Image, A.Sm_Title, A.Page_URL, A.Page_Name, A.Href_Attributes 
FROM #Request.DB_Prefix#Pages A, #Request.DB_Prefix#Pages B
WHERE 
A.Parent_ID = B.Page_ID AND
<cfif len(attributes.parent_id)>
A.Parent_ID = #Val(attributes.parent_ID)# AND
</cfif>
<cfif not attributes.all>A.Display = 1 AND</cfif>
A.Page_ID <> 0
ORDER BY  B.Title_Priority, A.Priority
</cfquery>

<!-----
Page_ID, Sm_Image, Sm_title, Page_url, Page_Name, Priority, menu_type, parent_id, ---->



